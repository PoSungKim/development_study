# 환경세팅
> ㅇㅇ
* ㅇㅇ

<hr>
<br>

## 기본 세팅
#### Spring + Spring-Batch + Docker + DBMS (h2)

<br>

### build.gradle 세팅

```gradle
runtimeOnly 'com.h2database:h2'
implementation 'org.springframework.boot:spring-boot-starter-batch'
compileOnly 'org.projectlombok:lombok'
annotationProcessor 'org.projectlombok:lombok'
```

* Dependency
  * org.springframework.boot:spring-boot-starter-batch
    * org.springframework.batch:spring-batch-core
      * org.springframework.batch:spring-batch-infrastructure
        * ItemReader, ItemProcessor, ItemWriter 등 Common 성, Infra 성 Class의 모음
        
<br>

### Application.java 세팅
```java
@EnableBatchProcessing
@SpringBootApplication
public class SpringBatchApplication {

    public static void main(String[] args) {
        SpringApplication.run(SpringBatchApplication.class, args);
    }

}
```
* 설정 클래스 실행 (설정 초기화 + 실행 + 빈 등록) --> 상단에서 하단 순으로 실행
  * @SimpleBatchConfiguration
    * JobBuilderFactory + StepBuilderFactory 빈 생성
    * 프록시 객체 형태로 생성
  * @BatchConfigurerConfiguration
    * BasicBatchConfigurer
      * 프록시 객체에서 사용하는 Target 클래스, 구현체 생성
    * JpaBatchConfigurer
      * JPA 관련 객체 생성
    * +...BatchConfigurer
      * 개발자 정의 설정 객체 생성 가능, BatchConfigurer 인터페이스를 통해 
  * @BatchAutoConfiguration
      * JobLauncherApplicationRunner 빈 생성

<br>

### @Configuration 기본 설정
```java
@Configuration
public class MyJobConfiguration {

    private final JobBuilderFactory jobBuilderFactory;
    private final StepBuilderFactory stepBuilderFactory;

    public MyJobConfiguration(JobBuilderFactory jobBuilderFactory, StepBuilderFactory stepBuilderFactory) {
        this.jobBuilderFactory = jobBuilderFactory;
        this.stepBuilderFactory = stepBuilderFactory;
    }

    @Bean
    public Job myJob() {
        return jobBuilderFactory.get("myJob")
                .start(myStep())
                .build();
    }

    @Bean
    public Step myStep() {
        return stepBuilderFactory.get("myStep")
                .tasklet( (contribution, chunkContext)-> {
                        System.out.println();
                        return RepeatStatus.FINISHED;
                })
                .build();
    }
}
```
* Job --> Step --> Tasklet
  * Job이 실행되면서 Step이 실행되고, Step이 실행되면서 Tasklet

<br>

### Terminal
```terminal
i.s.tutorial.SpringBatchApplication      : Started SpringBatchApplication in 0.613 seconds (JVM running for 0.915)
o.s.b.a.b.JobLauncherApplicationRunner   : Running default command line with: []
o.s.b.c.l.support.SimpleJobLauncher      : Job: [SimpleJob: [name=myJob]] launched with the following parameters: [{}]
o.s.batch.core.job.SimpleStepHandler     : Executing step: [myStep]
============================
myStep has run!
============================
o.s.batch.core.step.AbstractStep         : Step: [myStep] executed in 5ms
o.s.batch.core.job.SimpleStepHandler     : Executing step: [myStep2]
============================
myStep2 has run
============================
o.s.batch.core.step.AbstractStep         : Step: [myStep2] executed in 1ms
o.s.b.c.l.support.SimpleJobLauncher      : Job: [SimpleJob: [name=myJob]] completed with the following parameters: [{}] and the following status: [COMPLETED] in 19ms
```

<br>
<hr>
<br>

