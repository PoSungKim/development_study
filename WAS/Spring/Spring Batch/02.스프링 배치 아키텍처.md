# 스프링 배치 아키텍처
> `배치`에 대한 기본기 중요
* 은행에서는 많은 배치 업무들이 새벽에 진행 됌

<hr>
<br>

## 스프링 배치 기본 구조
#### 

<div align="center">
  <img src="https://github.com/PoSungKim/development_study/assets/37537227/4fca362b-1df8-4317-bbd9-1a03f1fd2c11">
</div>

### [Layered Architecture]
* Layered Architecture = (Applicaiton + Batch Core + Batch Infrastructure)
* Dependency
  * org.springframework.boot:spring-boot-starter-batch
    * org.springframework.batch:spring-batch-core
      * org.springframework.batch:spring-batch-infrastructure
        * ItemReader, ItemProcessor, ItemWriter 등 Common 성, Infra 성 Class의 모음

<br>

<div align="center">
  <img width="80%" src="https://user-images.githubusercontent.com/37537227/118364615-15e5ad80-b5d4-11eb-87c8-ee6b3f8d1729.png">
</div>

<br>
<hr>
<br>

## Job
#### 

<br>

### [Job]
* 기본 개념
  * 배치의 실행 단위로, 배치 작업 하나에 대한 명세서이자 설계도
  * N개의 Step 실행 가능 (Flow 제어 가능)
* 기본 구현체
  * SimpleJob
    * 순차적으로 Step을 실행시키는 Job
    * Step을 실행시킨다
  * FlowJob
    * 특정 조건 혹은 흐름에 따라 Step을 구성하여 실행시키는 Job
    * Flow를 실행시킨다
* 관련 도메인
  * JobLauncher
  * JobParameters
  * Job
  * JobExecution
  * JobInstance

<br>

### [JobInstance]
* Job이 실행될 때 생성되는 논리적 실행 단위
  * 즉, 동일한 설정과 구성의 Job이 존재하는데, 실행될 때마다의 Job 각각을 식별할 수 있는 것이 JobInstance
* JobInstance 객체의 입장 : (Job, JobParameters)가 중복되어 저장될 수 없음
  * 없다면, 신규 객체 생성
  * 있다면, 기존 객체 리턴
* BATCH_JOB_INSTANCE 테이블의 입장 : (JOB_NAME, JOB_KEY)가 중복되어 저장될 수 없음
  * JOB_KEY 칼럼 값은 JobParameters의 해시값

<br>

### [JobParameter]
* JobLauncher가 배치 작업을 기동시킬 때 사용하는 값
* 동일한 Job 내에서 JobInstance를 식별할 수 있게 해주는 값
* JobParameter 생성 및 바인딩 방법
  * JAR 파일 실행 옵션
    * 
  * Java 코드내 생성
    * 
  * SpEL 사용
    * 

<br>
<hr>
<br>

## Step
#### 

<br>

### [Step]
* Job의 세부 실행 단위이며, N개가 등록되어 실행됌
* 실행 단위
  * Chunk 기반 : 하나의 큰 덩어리를 n개씩 나눠서 실행
  * Task 기반 : 하나의 작업 기반으로 실행
 
<br>
<hr>
<br>
