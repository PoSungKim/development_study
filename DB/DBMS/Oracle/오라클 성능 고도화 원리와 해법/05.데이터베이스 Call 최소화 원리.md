# 데이터베이스 Call 최소화 원리
> 불필요하고 반복적인 Call 수행횟수 최소화가 매우 중요
* 데이터베이스 Call = {Parse Call, Execute Call, Fetch Call}
* 데이터베이스 Call = {User Call, Recursive Call}

<div align="center">
  <img width="50%" src="https://github.com/PoSungKim/development_study/assets/37537227/863a6853-2a63-4144-aa9c-3a23dcb2bf1b" >
</div>

<hr>
<br>

## Call 통계
#### 

<br>

### Call 통계
* Parse Call : 커서를 파싱하는 과정에 대한 통계 (실행계획을 생성하거나 찾는 과정)
  * 바인드 변수 사용
  * 세션 커서 캐싱
  * 애플리케이션 커서 캐싱 (Parse Call 아예 발생 X)
* Execute Call : 커서를 실행하는 단계에 대한 통계
  * INSERT, UPDATE, DELETE, MERGE 등 DML
  * INSERT ... SELECT
  * SELECT FOR UPDATE
* Fetch Call : SELECT문에서 실제 레코드를 읽어 사용자가 요구한 결과집합을 반환하는 과정에 대한 통계
  * SELECT
  * SORT
  * GROUP BY

<br>

### User Call vs Recursive Call
* User Call : OCI (Oracle Call Interface)를 통해 오라클 외부로부터 들어오는 Call
  * Peak 시간대의 시스템 장애 주범
  * 해결안
    * Loop 쿼리를 해소하고 집합적 사고를 통해 One-SQL로 구현
    * Array Processing : Array 단위 Fetch, Bulk Insert/Update/Delete
    * 부분범위처리 원리 활용
    * 효과적인 화면 페이지 처리 
    * 사용자 정의 함수/프로시저/트리거의 적절한 활용
* Recursive Call : 오라클 내부에서 발생하는 Call
  * 발생 요인 
    * SQL 파싱
    * 최적화 과정에서 발생하는 Data Dictionary 조회
    * PL/SQL로 작성된 사용자 정의 함수/프로시저/트리거 내에서의 SQL 수행
  * 해결안
    * 바인드 변수를 통한 하드파싱 발생횟수 감소
    * PL/SQL 내부 수행 이해 필요
  * Recursive Depth
    * 프로시저 내부에서 또 다른 프로시저 호출한 횟수
    * PL/SQL은 가상머신 (Virtual Machine) 상에서 수행되는 인터프리터(Interpreter) 언어이므로 빈번한 호출 시 컨텍스트 스위칭 (Context Switching)이 발생하여 성능 감소

| Call 구분 | User | Recursive |
|-----------|------|-----------|
| Parse     |Parse Call 최소화 --> 애플리케이션 커서 캐싱 기법|동일|
| Execute   |Array Processing, One-SQL로 구현, AP 설계 및 표준 가이드|Array Processing, 함수 반복 호출 최소화 (조인, 스칼라 서브쿼리 활용)|
| Fetch     |Array 단위 Fetch, 부분범위처리 활용, 페이지 처리|Cursor FOR Loop문 사용|

<br>
<hr>
<br>

## 
#### 

<br>

### 

<br>
<hr>
<br>
