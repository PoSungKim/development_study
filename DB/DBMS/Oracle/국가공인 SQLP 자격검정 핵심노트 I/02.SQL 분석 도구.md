# SQL 분석 도구
> 
* 

<hr>
<br>

## 예상 실행계획
#### 

<br>

### Oracle Explan For...
* 예상 실행계획
  * Plan Hash Value
  * 오브젝트 액세스 방식 (Operation)
  * 오브젝트명
  * 예상 Cardinality (rows)
  * 예상 데이터 크기 (bytes)
  * 예상 Cost
  * 예상 CPU Time
* Predicate Information (identified by operation id)
  * 조건절 정보

<br>

### Oracle Autotrace
* 예상 실행계획
* Predicate Information (identified by operation id)
* Statistics
  * 실제 디스크에서 읽은 블록 수
  * 실제 기록한 Redo 크기

<br>

### Oracle Autotrace Options
```sql
${option};
select * from emp where ename = 'SCOTT';
```
* set autotrace on
  * 실제실행
  * 결과집합
  * 예상실행계획
  * 실행통계
* set autotrace on explain
  * 실제실행
  * 결과집합
  * 예상실행계획
* set autotrace on statistics
  * 실제실행
  * 결과집합
  * 실행통계
* set autotrace traceonly
  * 실제실행
  * 예상실행계획
  * 실행통계
* set autotrace traceonly explain
  * 예상실행계획
* set autotrace traceonly statistics
  * 실제실행
  * 실행통계

<hr>
<br>
<br>

## SQL Trace

<br>

### Oracle SQL Trace (파일 저장)

```sql
alter session set sql_trace = true;
select * from emp where ename = 'SCOTT';
```

<br>

### tkprof (파일 저장)
* TKProf 유틸리티를 사용하면 SQL 트레이스 파일을 분석해서 리포트 파일을 생성해 준다

```sql
tkprof ora10g_ora_14370_oraking.trc report.prf sys=no
```

<br>

### Oracle SQL Trace (SGA 메모리 저장)

```sql
select /*+ gather_plan_statistics */ count(*) from big_table;

-- 직전 쿼리
-- display_cursor 관련 파라미터
-- statistics_level
-- _rowsource_execution_statistics
select * from table( dbms_xplan.display_cursor(null, null, 'allstats last'));

-- 지정 쿼리
select * from V$SQL_PLAN_STATISTICS_ALL;
select sql_id, child_number from v$sql;
select * from table( dbms_xplan.display_cursor(sql_id, child_number, 'allstats last'));
```

<div align="center">
  <img width="80%" src="https://github.com/PoSungKim/development_study/assets/37537227/6ef07e1f-b8d0-4849-8777-59140ca45404"> 
</div>

* starts : 각 오퍼레이션 단계별 실행 횟수
* E-Rows : 옵티마이저가 예상한 Rows
* A-Rows : 각 오퍼레이션 단계에서 읽거나 갱신한 로우 수
* A-Times : 각 오퍼레이션 단계별 소요시간
* Buffers : 캐시에서 읽은 버퍼 블록 수
* Reads : 디스크에서 읽은 블록 수

<br>

### Oracle SQL Trace
* Parse/Execute/Fetch Call
  * 실제 사용한 CPU Time
  * 실제 디스크에서 읽은 블록 수
* 하드파싱 횟수
* Optimizer Mode
* Row Source Operation

<br>

### Oracle AutoTrace vs. Oracle SQL 
* consistent gets = query
* SQL*Net roundtrips to/from client = fetch call count
* rows processed = fetch rows
* recursive calls : 하드파싱 과정에 딕셔너리를 조회하거나 DB저장형 함수에 내장된 SQL을 수행할 때 발생한 Call 횟수를 표시한다

<hr>
<br>
<br>

## 응답 시간 분석

<hr>
<br>
<br>
