# 애그리거트
> 
* 

<hr>
<br>

## 
#### 

<br>

### 애그리거트
* 관련된 객체를 하나의 군으로 묶어 줌
  * 같거나 비슷한 라이프싸이클을 갖는다 (ex : Order-OrderLine)
  * 별도의 라이프싸이클을 갖는 관계에서는 서로 다른 애그리거트가 된다 (ex : 상품-리뷰)
* 상위 수준에서 도메인 모델 간의 관계 파악 가능! 작은 그림만 파악해서는 요구사항에 대해서 코드 수정을 최소한으로 하는 협의로만 갈 수밖에 없음!
* 애그리거트의 경계 설정의 기본
  * `도메인 규칙`
  * `요구사항`
* 예시
  * 주문
    * Order
    * Orderer
    * Shipping Info
    * Receiver
    * Address
    * Delivery Tracking 
    * OrderLine 
  * 결제
    * Payment Info
  * 분류
    * Category
  * 상품
    * Product
  * 리뷰
    * Review
  * 회원
    * Member
    * Member Grade

<br>

### 애그리거트 루트와 역할
* 애그리거트 루트는 애그리거트 내부의 다른 객체를 조합해서 기능 완성

<br>

### 애그리거트 루트와 역할 Example (1) GOOD 👍
```java
public class Order {
    private Money totalAmounts;
    private List<OrderLine> orderLines;
    
    private void calculateTotalAmounts() {
        int sum = orderLines.stream()
                            .mapToInt(ol -> ol.getPrice() * ol.getQuantity())
                            .sum();
                            
        this.totalAmounts = new Money(sum);
    }
}
```

```java
public class Member {
    private Password password;
    
    public void changePassword(String currentPassword, String newPassword) {
        if (!password.match(currentPassword) {
            throw new PAsswordNotMatchException();
        }
    }
    this.password = new Password(newPassword);
}
```

### 애그리거트 루트와 역할 Example (2) GOOD 👍
```java
public class OrderLine {
    private List<OrderLine> lines;
    
    public Money getTotalAmounts() {
        // 구현
    }
    
    public void changeOrderLines(List<OrderLine> newLines) {
        this.lines = newLines;
    }
}
```

```java
public class Order { 
    private Money totalAmounts;
    private OrderLines orderLines;
    
    public void changeOrderLines(List<OrderLine> newLines) {
        orderLines.changeOrderLines(newLines);
        this.totalAmounts = orderLines.getTotalAmounts();
    }
}
```

### 애그리거트 루트와 역할 Example (3) BAD 👎
```java
OrderLines lines = order.getOrderLines();
lines.changeOrderLines(newOrderLines);
```

<br>

### 애그리거트와 리포지토리

<br>

### ID를 이용한 애그리거트 참조

<br>
<hr>
<br>
