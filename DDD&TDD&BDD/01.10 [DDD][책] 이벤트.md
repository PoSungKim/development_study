# 이벤트
> 강결합을 해결하는 방법들 중 하나인 이벤트!
* 비동기 이벤트 사용을 통해 두 시스템 간의 결합을 낮출 수 있다

<hr>
<br>

## 시스템 간 강결합 문제
#### 

<br>

### 강결합 Bad Example 1)
```java
public class Order {
    
    public void cancel(RefundService refundService) {
        verifyNotYetShipped();
        this.state = OrderState.CANCELED;
        
        this.refundStatus = State.REFUND_STARTED;
        
        try {
            refundService.refund(getPaymentId());
            this.refundStatus = State.REFUND_COMPLETED;
        } catch (Exception ex) {
            ...
        }
    }
    
}
```

<br>

### 강결합 Bad Example 2)

```java
public class CancelOrderService {
    private RefundService refundService;
    
    @Transactional
    public void cancel(OrderNo orderNo) {
        Order order = findOrder(orderNo);
        order.cancel();
        
        order.refundStarted();
        try {
            refundService.refund(order.getPaymentId()); // 외부 서비스 성능에 직접 영향을 받는다.
            order.refundCompleted();
        } catch(Exception ex) {
            ...
        }
    }
}
```

<br>

### 강결합 Bad Example 3)
```java
public class Order {
    // 기능을 추가할 때마다 파라미터가 함께 추가되면
    // 다른 로직이 더 많이 섞이고, 트랜잭션 처리가 더 복잡해진다.
    public void cancel(RefundService refundService, NotiService notiSvc) {
        verifyNotYetShipped();
        this.state = OrderState.CANCELED;
        
        ...
        
        // 주문+결제+통지 로직이 섞임
        // refundService는 성공하고, notiSvc는 실패하면?
        // refundService와 notiSvc 중 무엇을 먼저 처리하나?
    }
}
```
* 도메인 객체에 외부 서비스를 주입하는 형태의 강결합 단점
  * Transaction 처리를 어떻게 해야할지 고민 발생
  * 외부서비스의 응답 시간이 길어질 수 있다는 고민 발생
  * 주문 로직과 결제 로직이 섞이는 설계 문제 발생
    * 즉, 환불서비스가 변경되면 Order에게도 영향을 주게 됨

<br>

### 이러한 강결합을 해결하는 방법 이벤트!
* 주문 바운디드 컨텍스트와 결제 바운디드 컨텍스트의 강결합으로 인한 문제

<br>
<hr>
<br>

## 이벤트 개요
#### 이벤트 = '과거에 벌어진 어떤 것'

<br>

### 이벤트 관련 구성요소


<br>

### 이벤트의 구성

<br>

### 이벤트 용도

<br>

### 이벤트 장점

<br>
<hr>
<br>

## 이벤트, 핸들러, 디스패처 구현
#### 

<br>

### 이벤트 클래스

<br>

### Events 클래스와 ApplicationEventPublisher

<br>

### 이벤트 발생과 이벤트 핸들러

<br>

<br>
<hr>
<br>

## 동기 이벤트 처리 문제
#### 

<br>

### 

<br>
<hr>
<br>

## 비동기 이벤트 처리
#### 

<br>

### 로컬 핸들러 비동기 실행

<br>

### 메시징 시스템을 이용한 비동기 구현

<br>

### 이벤트 저장소를 이용한 비동기 처리

<br>

### 이벤트 저장을 위한 이벤트 핸들러 구현 

<br>

### REST API 구현

<br>

### 포워더 구현

<br>
<hr>
<br>

## 이벤트 적용 시 추가 고려 사항
#### 

<br>

### 이벤트 처리와 DB 트랜잭션 고려


<br>
<hr>
<br>
