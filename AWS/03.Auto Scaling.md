# Auto Scaling
> 미리 정해 놓은 규칙에 따라 워크로드를 자동으로 확대 또는 축소할 수 있는 기술로 클라우드가 제공하는 탄력성에 의해 만들어지고, 사용자의 요구 수준을 세심하게 반영할 수 있는 기술
* Peak Workloads에 맞춰 충분한 리소스 확보 가능
* 동일한 AMI로 EC2 그룹 관리

<hr>
<br>

## 개요
####  

<br>

### [문제점]
* 대부분의 기업들은 피크 워크로드를 적절하게 예상하는 일은 매우 어려움 >> 부족한 리소스 혹은 과잉 리소스 프로비전으로 이어지는 문제
* Black Friday에 맞춰 예산을 배정하고 리소스를 확보하면 해당 시즌을 제외한 일년 내내 CPU 리소스는 15~20%밖에 사용 못하고 리소스를 낭비

<br>

### [해결 방안]
* Auto Scaling (축소, 확장), Elastic Load Balancing (분배)

<br>
<hr>
<br>

## 장점
#### 

<br>

### []
* 동적 스케일링 
  * 실시간으로 최적의 CPU 및 메모리 등의 리소스 제공 가능
* 최상의 사용자 경험 및 성능 향상 
  * Auto Scaling 규칙 추가를 통해 최상의 사용자 경험 제공
* 헬스 체크와 서버 플릿 관리 
  * EC2 서버 집합 (Server Fleet)에 대한 헬스 체크 모니터링
  * 특정 인스턴스 문제 발생 시 다른 인스턴스로 교체
  * Elastic Load Balancing (ELB)로 설정 시, ELB의 헬스 체크 기능 사용 가능
* 로드 밸런싱
  * Auto Scaling = Scale Up + Scale Down
  * ELB = 다수의 EC2 인스턴스에게 분배 + 다수의 AZ에 분포된 인스턴스에게 분배
* 타깃 트래킹
  * 특정 타깃에 대해서 Auto Scaling >> EC2 인스턴스 수 조정
  * 애플리케이션 서버의 CPU 활용률 65%로 설정 >> 활용률에 맞춰 EC2 인스턴스의 수 자동 조정
* 리소스 비용 관리
  * 리로스 최적화를 통한 비용 관리
* 예측적 확장
  * ML과 통합된 Auto Scaling은 실제 사용자의 EC2 사용량 정보를 수집한 뒤 머신러닝 모델을 이용해 일간 또는 주간 예상 트래픽에 따라 리소스 사용량 예측 가능 >> 컴퓨터 용량 자동 확장 및 축소 가능

<br>

### [EC2 인스턴스 외의 서비스에도 적용 가능]
* EC2 Spot 인스턴스
* EC2 Container Service (ECS)
* Elastic Map Reducer(EMR) 클러스터
* AppStream 2.0 인스턴스
* Amazon Aurora Replicas
* DynamoDB

<br>
<hr>
<br>

## 리소스 확장 및 축소 계획 수립
#### Auto Scaling 그룹에 EC2 인스턴스 추가 >> 서버의 최소 대수 및 최대 대수 정의 >> 스케일링 정책 정의

<br>

### [확장 가능한 리소스 파악]
* CloudFormation
* 태그
* EC2 Auto Scaling 그룹

<br>

### [리소스 확장 전략 구체화 - 스케일업 및 스케일다운 전략 설정]
* 가용성 기준 최적화
  * CPU/리소스 활성화 수준 40%
* 가용성과 비용의 균형
  * CPU/리소스 활성화 수준 50%
* 비용 기준 최적화
  * CPU/리소스 활성화 수준 70%
* 커스텀 스케일링 전략
  * 원하는 지표로 원하는 CPU/리소스 활성화 수준 설정

<br>

### [스케일링 전략 선택]
* 예측적 스케일링 : forecasting
  * 기업 애플리케이션에 대한 요구  수준이 높아지기 전에 예방적으로 리소스를 프로비전할 수 있는 장점
* 동적 스케일링  : creating target tracking scaling policies

<br>
<hr>
<br>

## EC2 Auto Scaling 활용
#### 

<br>

### [실행환경 설정 템플릿]
* 

<br>

### [Auto Scaling 그룹]
* 스케일업, 스케일다운 규칙의 모음으로 EC2 인스턴스의 시작부터 삭제까지의 모든 동작에 대한 규칙과 정책 포함
* 스케일링 유형
  * 인스턴스 레벨 유지 (기본)
    * 항상 실행되는 인스턴스의 수
  * 수동 스케일링 (비추천)
    * 콘솔, API, CLI를 통해 수동으로 스케일링
  * 요구별 스케일링 
    * CloudWatch가 모니터링하는 CPU, Disk I/O, Network I/O 등의 주요 지표를 바탕으로 스케일링 (항상 스케일업 정책과 스케일다운 정책을 함께 정의)
    * ex) CPU 처리 용량이 80% 수준으로 5분 이상 지속될 경우 새 서버 추가
  * 일정별 스케일링
    * 트래픽이 예측 가능하다면, 맞춰서 특정 시간대에 스케일링
* Amazon SNS (Simple Notification Service) 알림을 통해 스케일업 또는 스케일다운 시기 안내 가능
  * HTTP, HTTPS, POST, SMTP, Amazon SQS의 메세지 큐 방식으로 알림 전송 가능
* 하나의 리전에서만 사용 가능
  * 하나의 리전에 있는 다수의 AZ 사용 가능 >> 고가용성 아키텍처 구현 가능
* Auto Scaling 그룹 개수는 정책에 따라 변동 중
* 스케일링 정책
  * 심플 스케일링 
    * 단 하나의 스케일링 정책 = 스케일업 정책 + 스케일다운 정책
    * `이벤트에 반응해 스케일링하며 특정 이벤트에 대해 매번 같은 액션 수행`
    * 경고 지표 (alarm) : CPU 활용 지표가 80%에 도달하면 하나의 인스턴스 추가, 40% 미만이면 하나의 인스턴스를 감소
    * 쿨다운 기간 (cooldown period) : 새 인스턴스의 시작/정지를 위한 대기 시간
  * 단계별 심플 스케일링
    * 심플 스케일링 보다 세분화된 조건으로 정책을 생성할 수 있는 정책
      * 50 <= CPU Utilization < 60
      * 60 <= CPU Utilization < 70
      * 70 <= CPU Utilization < infinity
    * 용량 증가 및 감소 설정
      * 정확한 용량 (Exact Capacity): 현재 용량 2, 조정 용량 4 >> 2 + `2` = 4
      * 숫자 지정 용량 변경 (Change in Capacity): 현재 용량 2, 조정 용량 4 >> 2 + `4` = 6
      * 퍼센트 단위의 용량 변경 (Percentage Change in Capacity): 현재 용량 10, 조정 용량 20% >> 10 + `10 * 0.2` = 12
  * 타깃 트래킹 스케일링
    * 미리 정의된 성능 지표 혹은 커스텀 성능 지표를 사용하여 타깃 값으로 설정하는 정책
    * ex) 성능지표 = CPU 활용율, 타깃 값 = 50% >> Auto Scaling이 EC2 인스턴스 개수를 조절하여 CPU 활용률이 40% 수준을 유지하도록 운영

<br>

### []
* 
